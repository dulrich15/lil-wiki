{% extends "wiki/base.html" %}
{% load rst_tags %}

{% block extra-script %}
$(document).keydown(function(e) {
    var keycode = e.which || e.keyCode;
    var key = String.fromCharCode(keycode).toLowerCase()

    {% if user.is_staff %}
    if (key == 'e' && e.ctrlKey)
    {
        location.href='{% url wiki_edit page.title %}';
        e.preventDefault();
    }
    {% endif %}
});
{% endblock %}

{% block main-content %}
<div{% if user.is_staff %} ondblclick="location.href='{% url wiki_edit page.title %}';"{% endif %}>
    <h1 id="title">{{ page.title }}</h1>
    <div id="content">
    {{ page.content|rst2html }}
    </div>
</div>

{% if page.parent or page.children or page.siblings %}
<div id="related-pages">
    <h2>Related Pages</h2>
    {% if page.parent %}
    <p>Up to&hellip;</p>
    <ul>
        <li><a href="{% url wiki_show page.parent.pg %}">{{ page.parent.title }}</a></li>
    </ul>
    {% endif %}
    {% if page.children %}
    <p>Down to&hellip;</p>
    <ul>
        {% for page in page.children.dirs %}
        <li>» <a href="{% url wiki_show page.pg %}">{{ page.title }}</a></li>
        {% endfor %}
        {% for page in page.children.files %}
        <li><a href="{% url wiki_show page.pg %}">{{ page.title }}</a></li>
        {% endfor %}
    </ul>
    {% endif %}
    {% if page.siblings %}
    <p>Sideways&hellip;</p>
    <ul>
        {% for page in page.siblings.dirs %}
        <li>» <a href="{% url wiki_show page.pg %}">{{ page.title }}</a></li>
        {% endfor %}
        {% for page in page.siblings.files %}
        <li><a href="{% url wiki_show page.pg %}">{{ page.title }}</a></li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endif %}

<div id="controls">
    <h2>Page Controls</h2>
    <ul id="control_list">
        {% if user.is_staff %}
        <li><a href="{% url wiki_logout %}?next={% url wiki_show page.pg %}">Logout</a></li>
        {% else %}
        <li><a href="{% url wiki_login %}?next={% url wiki_show page.pg %}">Login</a></li>
        {% endif %}
        <li><a href="{% url wiki_root %}">WikiRoot</a></li>
        {% if user.is_staff %}
        <li><a href="{% url wiki_edit page.title %}">Edit Page</a></li>
        {% endif %}
    </ul>
</div>

{% include "website/mathjax.html" %}
{% endblock %}
